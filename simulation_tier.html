<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous" />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer" />
    <style>
      * {
        font-size: 14px !important;
      }
      .text-center {
        text-align: center;
      }
      body {
        position: absolute !important;
      }
      .txtr {
        height: 120px !important;
        font-size: 50px !important;
        letter-spacing: 0.2rem;
      }
    </style>

    <!-- Calculator -->
    <link rel="stylesheet" href="./assets/calculator/prism.css" />
    <script src="./assets/calculator/prism.js"></script>

    <link
      rel="stylesheet"
      href="./assets/calculator/SimpleCalculadorajQuery.css" />

    <title>Kalkulator-IFM</title>
  </head>

  <body style="background-color: #ececec !important" class="p-1">
    <table border="1" width="100%" cellpadding="2" cellspacing="0">
      <thead>
        <tr>
          <th class="text-center" width="20%">Product Desc.</th>
          <th colspan="2" class="text-center" width="80%">TIER</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td rowspan="1" id="rowspan_1" style="vertical-align: top">
            <br />
            Product Item ( 1 ) =
            <input
              type="text"
              class="jumlah p-1 inputan bold text-center"
              data-index="1"
              data-myval="0"
              data-type="jumlah"
              data-status="false"
              id="jumlah_1"
              placeholder="Total Jumlah"
              style="background: none; margin-top: 5px" />
            <input
              type="text"
              class="tumpangan p-1 inputan bold text-center"
              data-index="1"
              data-myval="0"
              data-type="tumpangan"
              data-status="false"
              id="tumpangan_1"
              placeholder="Tumpangan"
              style="background: none; margin-top: 15px" />
            <input
              type="text"
              class="per_tier p-1 inputan bold text-center"
              data-index="1"
              data-myval="0"
              data-type="per_tier"
              data-status="false"
              id="per_tier_1"
              placeholder="Per Tier"
              style="background: none; margin-top: 5px" />
            <br /><br />
          </td>
        </tr>
        <tr
          class="content-1"
          style="border-bottom: 3px solid black !important"></tr>
      </tbody>
    </table>

    <!-- Modal -->
    <div class="modal" tabindex="-1" id="modal-calculator">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title-calculator">Modal title</h5>
            <h3 id="live-cal">0</h3>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div id="micalc"></div>
            <button
              type="button"
              class="btn3d btn btn-dark mt-3 btn-lg btn-block backspace">
              <i class="fa fa-solid fa-arrow-left"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"></script>

    <script>
      document.activeElement.blur();

      $(document).ready(function () {
        $("input").focus(function () {
          $(this).blur();
        });

        $(".close").click(function () {
          $("#modal-calculator").hide();
        });

        $("#micalc").Calculadora({
          EtiquetaBorrar: "Clear",
        });

        $(".android input").on("focus", function (e) {
          $(this).blur();
          e.preventDefault();
        });

        $(".backspace").click(function () {
          var str = $("#micalctxtResultado").val();
          str = str.slice(0, -1);
          $("#micalctxtResultado").val(str);

          $("#live-cal").html(eval(str.val()).toLocaleString("ID"));
        });

        $(".jumlah").focus(function () {
          $(".inputan").attr("data-status", "false");
          $(this).attr("data-status", "true");

          $("#modal-calculator").show();

          if (parseInt($(this).val())) {
            $("#micalctxtResultado").val(
              parseInt($(this).val().replace(".", ""))
            );
          } else {
            $("#micalctxtResultado").val("");
          }

          $(".modal-title-calculator").html("Total : &nbsp;");
        });

        $(".tumpangan").focus(function () {
          $(".inputan").attr("data-status", "false");
          $(this).attr("data-status", "true");

          $("#modal-calculator").show();

          if (parseInt($(this).val())) {
            $("#micalctxtResultado").val(
              parseInt($(this).val().replace(".", ""))
            );
          } else {
            $("#micalctxtResultado").val("");
          }
          $(".modal-title-calculator").html("Tumpangan : &nbsp;");
        });

        $(".per_tier").focus(function () {
          $(".inputan").attr("data-status", "false");
          $(this).attr("data-status", "true");

          $("#modal-calculator").show();

          if (parseInt($(this).val())) {
            $("#micalctxtResultado").val(
              parseInt($(this).val().replace(".", ""))
            );
          } else {
            $("#micalctxtResultado").val("");
          }
          $(".modal-title-calculator").html("Per Tier : &nbsp;");
        });

        $(".jumlah").change(function () {
          calculationData($(this).data("index"));
        });

        $(".tumpangan").change(function () {
          calculationData($(this).data("index"));
        });

        $(".per_tier").change(function () {
          calculationData($(this).data("index"));
        });

        function calculationData(index) {
          var jumlah = $("#jumlah_" + index);
          var tumpangan = $("#tumpangan_" + index);
          var per_tier = $("#per_tier_" + index);

          var content = $("tr.content-" + index);
          var rowspan = $("#rowspan_" + index);

          if (parseInt(jumlah.attr("data-myval"))) {
            var response = converter(
              parseInt(jumlah.attr("data-myval")) -
                parseInt(tumpangan.attr("data-myval")),
              parseInt(per_tier.attr("data-myval"))
            );

            var set_rowspan = response.total_per_tier;

            if (response.sisa_tier) {
              set_rowspan += 1;
            }

            $(".tr-" + index).remove();

            var CONTENT_TIER = ``;
            var left = true;

            if (parseInt(tumpangan.attr("data-myval"))) {
              CONTENT_TIER += `
                <tr class="tr-${index}">
                    <td style="text-align:center; font-size: 27px; color:red;" colspan="2"><b>${parseInt(
                      tumpangan.attr("data-myval")
                    )}</b></td>
                </tr>
              `;
              rowspan.attr("rowspan", set_rowspan + 3);
            } else {
              rowspan.attr("rowspan", set_rowspan + 2);
            }

            for (i = 1; i <= response.total_per_tier; i++) {
              CONTENT_TIER += `
                  <tr class="tr-${index}">
                      <td style="text-align:center; font-size: 27px;"><b>${
                        left == true ? per_tier.attr("data-myval") : ""
                      }</b></td>
                      <td style="text-align:center; font-size: 27px;"><b>${
                        left == false ? per_tier.attr("data-myval") : ""
                      }</b></td>
                  </tr>
              `;

              if (i % 5 == 0) {
                left = !left;
              }
            }

            if (response.sisa_tier) {
              left = !left;

              CONTENT_TIER += `
                  <tr class="tr-${index}">
                      <td style="text-align:center; font-size: 27px; color:red;" colspan="2"><b>${
                        left != true ? response.sisa_tier : ""
                      }</b></td>
                  </tr>
              `;
            }

            $(CONTENT_TIER).insertAfter(content);
          }
        }

        function converter(total, per_tier) {
          if (total > 0 && per_tier > 0) {
            total = parseInt(total);
            per_tier = parseInt(per_tier);

            var result = Math.floor(total / per_tier);

            if (result * per_tier == total) {
              return { total_per_tier: result, sisa_tier: 0 };
            } else {
              var tot = result * per_tier;
              total = total - tot;

              if (result) return { total_per_tier: result, sisa_tier: total };

              return { total_per_tier: 0, sisa_tier: total };
            }
          }

          return { total_per_tier: 0, sisa_tier: 0 };
        }
      });
    </script>

    <script src="./assets/calculator/SimpleCalculadorajQuery.js"></script>
  </body>
</html>
